{
    "sourceFile": "app/src/features/sale-panel/AddNote.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1746605473025,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1746721911047,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,20 +1,11 @@\n-/* eslint-disable */\n-import styled from \"styled-components\";\n-import Form from \"../../ui/Form\";\n-import Input from \"../../ui/Input\";\n-import { useForm } from \"react-hook-form\";\n-import FormRow from \"../../ui/FormRow\";\n-import Button from \"../../ui/Button\";\n-import { useState } from \"react\";\n-\n-const StyledAddNote = styled.div`\n-  h3 {\n-    margin-bottom: 3rem;\n-  }\n-`;\n-\n-function AddNote({ onCloseModal, onConfirm, disabled, orderId }) {\n+function AddNote({\n+  onCloseModal,\n+  onConfirm,\n+  disabled,\n+  orderId,\n+  panel: fixedPanel,\n+}) {\n   const {\n     register,\n     formState: { errors },\n     handleSubmit,\n@@ -45,9 +36,9 @@\n           },\n           body: JSON.stringify({\n             order: orderId,\n             text: data.text,\n-            panel: data.panel, // ✅ اضافه شد\n+            panel: fixedPanel ?? data.panel, // استفاده از پنل ثابت اگر موجود بود\n           }),\n         }\n       );\n \n@@ -87,24 +78,25 @@\n             })}\n           />\n         </FormRow>\n \n-        {/* پنل */}\n-        <FormRow error={errors?.panel?.message}>\n-          <select\n-            disabled={disabled || submitting}\n-            {...register(\"panel\", {\n-              required: \"انتخاب پنل الزامی است!\",\n-            })}\n-          >\n-            <option value=\"\">انتخاب پنل</option>\n-            <option value=\"sales\">فروش</option>\n-            <option value=\"financial\">مالی</option>\n-            <option value=\"execution\">اجرا</option>\n-          </select>\n-        </FormRow>\n+        {/* فقط اگر پنل به صورت prop نیامده باشد، فرم انتخاب پنل را نشان بده */}\n+        {!fixedPanel && (\n+          <FormRow error={errors?.panel?.message}>\n+            <select\n+              disabled={disabled || submitting}\n+              {...register(\"panel\", {\n+                required: \"انتخاب پنل الزامی است!\",\n+              })}\n+            >\n+              <option value=\"\">انتخاب پنل</option>\n+              <option value=\"sales\">فروش</option>\n+              <option value=\"financial\">مالی</option>\n+              <option value=\"execution\">اجرا</option>\n+            </select>\n+          </FormRow>\n+        )}\n \n-        {/* دکمه ارسال */}\n         <FormRow>\n           <Button disabled={disabled || submitting}>\n             {submitting ? \"در حال ارسال...\" : \"ارسال\"}\n           </Button>\n@@ -112,6 +104,4 @@\n       </Form>\n     </StyledAddNote>\n   );\n }\n-\n-export default AddNote;\n"
                },
                {
                    "date": 1746721927661,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,19 @@\n+/* eslint-disable */\n+import styled from \"styled-components\";\n+import Form from \"../../ui/Form\";\n+import Input from \"../../ui/Input\";\n+import { useForm } from \"react-hook-form\";\n+import FormRow from \"../../ui/FormRow\";\n+import Button from \"../../ui/Button\";\n+import { useState } from \"react\";\n+\n+const StyledAddNote = styled.div`\n+  h3 {\n+    margin-bottom: 3rem;\n+  }\n+`;\n+\n function AddNote({\n   onCloseModal,\n   onConfirm,\n   disabled,\n@@ -104,4 +119,6 @@\n       </Form>\n     </StyledAddNote>\n   );\n }\n+\n+export default AddNote;\n"
                },
                {
                    "date": 1746723228329,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,23 +94,23 @@\n           />\n         </FormRow>\n \n         {/* فقط اگر پنل به صورت prop نیامده باشد، فرم انتخاب پنل را نشان بده */}\n-        {!fixedPanel && (\n-          <FormRow error={errors?.panel?.message}>\n-            <select\n-              disabled={disabled || submitting}\n-              {...register(\"panel\", {\n-                required: \"انتخاب پنل الزامی است!\",\n-              })}\n-            >\n-              <option value=\"\">انتخاب پنل</option>\n-              <option value=\"sales\">فروش</option>\n-              <option value=\"financial\">مالی</option>\n-              <option value=\"execution\">اجرا</option>\n-            </select>\n-          </FormRow>\n-        )}\n+        {/* {!fixedPanel && (\n+          // <FormRow error={errors?.panel?.message}>\n+          //   <select\n+          //     disabled={disabled || submitting}\n+          //     {...register(\"panel\", {\n+          //       required: \"انتخاب پنل الزامی است!\",\n+          //     })}\n+          //   >\n+          //     <option value=\"\">انتخاب پنل</option>\n+          //     <option value=\"sales\">فروش</option>\n+          //     <option value=\"financial\">مالی</option>\n+          //     <option value=\"execution\">اجرا</option>\n+          //   </select>\n+          // </FormRow>\n+        )} */}\n \n         <FormRow>\n           <Button disabled={disabled || submitting}>\n             {submitting ? \"در حال ارسال...\" : \"ارسال\"}\n"
                }
            ],
            "date": 1746605473025,
            "name": "Commit-0",
            "content": "/* eslint-disable */\nimport styled from \"styled-components\";\nimport Form from \"../../ui/Form\";\nimport Input from \"../../ui/Input\";\nimport { useForm } from \"react-hook-form\";\nimport FormRow from \"../../ui/FormRow\";\nimport Button from \"../../ui/Button\";\nimport { useState } from \"react\";\n\nconst StyledAddNote = styled.div`\n  h3 {\n    margin-bottom: 3rem;\n  }\n`;\n\nfunction AddNote({ onCloseModal, onConfirm, disabled, orderId }) {\n  const {\n    register,\n    formState: { errors },\n    handleSubmit,\n    reset,\n  } = useForm();\n\n  const [submitting, setSubmitting] = useState(false);\n\n  async function onSubmit(data) {\n    const tokenData = JSON.parse(localStorage.getItem(\"token\"));\n    const token = tokenData?.access;\n\n    if (!token) {\n      console.error(\"No access token found\");\n      return;\n    }\n\n    setSubmitting(true);\n\n    try {\n      const response = await fetch(\n        \"https://amin-beton-back.chbk.app/api/order-management/add-note/\",\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${token}`,\n          },\n          body: JSON.stringify({\n            order: orderId,\n            text: data.text,\n            panel: data.panel, // ✅ اضافه شد\n          }),\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error(\"خطا در ثبت یادداشت\");\n      }\n\n      const result = await response.json();\n      console.log(\"Note added:\", result);\n      onConfirm?.(result);\n      reset();\n      onCloseModal();\n    } catch (error) {\n      console.error(\"Error adding note:\", error.message);\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  function onError(data) {\n    console.log(\"Validation error:\", data);\n  }\n\n  return (\n    <StyledAddNote>\n      <h3>افزودن یادداشت</h3>\n\n      <Form type=\"modal\" onSubmit={handleSubmit(onSubmit, onError)}>\n        {/* یادداشت */}\n        <FormRow error={errors?.text?.message}>\n          <Input\n            type=\"text\"\n            placeholder=\"یادداشت\"\n            disabled={disabled || submitting}\n            {...register(\"text\", {\n              required: \"این فیلد الزامی است!\",\n            })}\n          />\n        </FormRow>\n\n        {/* پنل */}\n        <FormRow error={errors?.panel?.message}>\n          <select\n            disabled={disabled || submitting}\n            {...register(\"panel\", {\n              required: \"انتخاب پنل الزامی است!\",\n            })}\n          >\n            <option value=\"\">انتخاب پنل</option>\n            <option value=\"sales\">فروش</option>\n            <option value=\"financial\">مالی</option>\n            <option value=\"execution\">اجرا</option>\n          </select>\n        </FormRow>\n\n        {/* دکمه ارسال */}\n        <FormRow>\n          <Button disabled={disabled || submitting}>\n            {submitting ? \"در حال ارسال...\" : \"ارسال\"}\n          </Button>\n        </FormRow>\n      </Form>\n    </StyledAddNote>\n  );\n}\n\nexport default AddNote;\n"
        }
    ]
}