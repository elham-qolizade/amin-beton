{
    "sourceFile": "app/src/features/financial-panel/FactorAndPriceWindow.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1745899348905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1745899368395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,26 +110,26 @@\n     fetchFactor();\n   }, [orderId]);\n   const handleCreateInvoice = async (e) => {\n     e.preventDefault();\n-\n+  \n     if (!price) {\n       alert(\"Ù„Ø·ÙØ§ Ù…Ø¨Ù„Øº Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯\");\n       return;\n     }\n-\n+  \n     setLoading(true);\n-\n+  \n     try {\n       const formData = new FormData();\n       formData.append(\"order\", orderDetails.id);\n       formData.append(\"price\", price);\n       if (invoiceFile) {\n         formData.append(\"invoice_file\", invoiceFile);\n       }\n-\n+  \n       const token = localStorage.getItem(\"token\"); // Ø§ÛŒÙ†Ø¬Ø§ ØªÙˆÚ©Ù† Ø±Ùˆ Ù…ÛŒÚ¯ÛŒØ±ÛŒÙ…\n-\n+  \n       const response = await fetch(\n         \"http://amin-beton-back.chbk.app/api/invoice-management/\",\n         {\n           method: \"POST\",\n@@ -138,15 +138,15 @@\n             Authorization: `Bearer ${token}`, // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‡Ø¯Ø± ØªÙˆÚ©Ù†\n           },\n         }\n       );\n-\n+  \n       if (response.ok) {\n         const data = await response.json();\n         alert(\"Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!\");\n-\n+  \n         setInvoices((prev) => [...prev, data]);\n-\n+  \n         setPrice(\"\");\n         setInvoiceFile(null);\n       } else {\n         alert(\"Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯!\");\n@@ -157,8 +157,9 @@\n     } finally {\n       setLoading(false);\n     }\n   };\n+  \n \n   return (\n     <Wrapper>\n       <Title>ÙØ§Ú©ØªÙˆØ± Ù†Ù‡Ø§ÛŒÛŒ Ø³ÙØ§Ø±Ø´</Title>\n"
                },
                {
                    "date": 1745899376384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,55 +108,45 @@\n     };\n \n     fetchFactor();\n   }, [orderId]);\n-  const handleCreateInvoice = async (e) => {\n+\n+  const handleCreateFactor = async (e) => {\n     e.preventDefault();\n+    const token = localStorage.getItem(\"accessToken\");\n \n-    if (!price) {\n-      alert(\"Ù„Ø·ÙØ§ Ù…Ø¨Ù„Øº Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯\");\n+    if (!price || !fileLink) {\n+      alert(\"Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù…ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.\");\n       return;\n     }\n \n-    setLoading(true);\n+    const formData = new FormData();\n+    formData.append(\"price\", price);\n+    formData.append(\"factor\", fileLink); // Ø§ÛŒÙ†Ø¬Ø§ ÙØ§ÛŒÙ„ Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…\n+    formData.append(\"order_id\", orderId);\n \n     try {\n-      const formData = new FormData();\n-      formData.append(\"order\", orderDetails.id);\n-      formData.append(\"price\", price);\n-      if (invoiceFile) {\n-        formData.append(\"invoice_file\", invoiceFile);\n-      }\n-\n-      const token = localStorage.getItem(\"token\"); // Ø§ÛŒÙ†Ø¬Ø§ ØªÙˆÚ©Ù† Ø±Ùˆ Ù…ÛŒÚ¯ÛŒØ±ÛŒÙ…\n-\n       const response = await fetch(\n-        \"http://amin-beton-back.chbk.app/api/invoice-management/\",\n+        \"https://amin-beton-back.chbk.app/api/orders/create-order-factor/\",\n         {\n           method: \"POST\",\n-          body: formData,\n           headers: {\n-            Authorization: `Bearer ${token}`, // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‡Ø¯Ø± ØªÙˆÚ©Ù†\n+            Authorization: `Bearer ${token}`,\n+            // ØªÙˆØ¬Ù‡ Ú©Ù† Ú©Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Content-Type Ø±Ùˆ Ø¯Ø³ØªÛŒ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒ! Ù…Ø±ÙˆØ±Ú¯Ø± Ø®ÙˆØ¯Ø´ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒØ¯Ù‡\n           },\n+          body: formData,\n         }\n       );\n \n-      if (response.ok) {\n+      if (response.status === 200) {\n         const data = await response.json();\n-        alert(\"Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!\");\n-\n-        setInvoices((prev) => [...prev, data]);\n-\n-        setPrice(\"\");\n-        setInvoiceFile(null);\n+        setFactor(data);\n+        setShowForm(false);\n       } else {\n-        alert(\"Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯!\");\n+        console.error(\"Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§Ú©ØªÙˆØ±\");\n       }\n     } catch (error) {\n       console.error(\"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙØ§Ú©ØªÙˆØ±:\", error);\n-      alert(\"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙØ§Ú©ØªÙˆØ±\");\n-    } finally {\n-      setLoading(false);\n     }\n   };\n \n   return (\n"
                }
            ],
            "date": 1745899348905,
            "name": "Commit-0",
            "content": "import { useEffect, useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport styled from \"styled-components\";\n\nconst Wrapper = styled.div`\n  padding: 6rem;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n  max-width: 800px;\n  margin: 0 auto;\n`;\n\nconst Title = styled.h2`\n  font-size: 2rem;\n  font-weight: bold;\n  color: var(--color-dark);\n  margin-bottom: 1rem;\n`;\n\nconst FormWrapper = styled.form`\n  background-color: #f1f1f1;\n  padding: 2rem;\n  border-radius: 8px;\n  margin-top: 3rem;\n`;\n\nconst InputField = styled.input`\n  width: 100%;\n  padding: 0.8rem;\n  margin-bottom: 1.5rem;\n  border-radius: 4px;\n  border: 1px solid #ccc;\n  font-size: 1rem;\n`;\n\nconst SubmitButton = styled.button`\n  padding: 0.8rem 1.6rem;\n  background-color: var(--color-brand-600);\n  color: #fff;\n  border: none;\n  border-radius: 4px;\n  font-size: 1.1rem;\n  cursor: pointer;\n  transition: background-color 0.3s;\n\n  &:hover {\n    background-color: var(--color-brand-800);\n  }\n\n  &:disabled {\n    background-color: var(--color-grey-400);\n    cursor: not-allowed;\n  }\n`;\n\nconst InvoiceBox = styled.div`\n  background-color: #e8ffe8;\n  padding: 2rem;\n  border-radius: 8px;\n  margin-top: 2rem;\n  border: 1px solid #00b300;\n`;\n\nfunction FinalInvoiceSection({ orderDetails }) {\n  const [loading, setLoading] = useState(true);\n  const [factor, setFactor] = useState(null);\n  const [price, setPrice] = useState(\"\");\n  const [fileLink, setFileLink] = useState(\"\");\n  const [showForm, setShowForm] = useState(false); // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù…\n\n  const orderId = orderDetails.id; // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² orderDetails Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª id\n\n  useEffect(() => {\n    console.log(\"Order ID: \", orderId); // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‚Ø¯Ø§Ø± orderId\n    const fetchFactor = async () => {\n      const token = localStorage.getItem(\"accessToken\");\n\n      if (!token) {\n        console.error(\"ØªÙˆÚ©Ù† Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!\");\n        return;\n      }\n\n      try {\n        const response = await fetch(\n          \"https://amin-beton-back.chbk.app/api/orders/get-order-factor/\",\n          {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: `Bearer ${token}`,\n            },\n            body: JSON.stringify({ order_id: orderId }), // Ø§Ø² orderId Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯\n          }\n        );\n\n        if (response.status === 200) {\n          const data = await response.json();\n          setFactor(data);\n        } else if (response.status === 404) {\n          setShowForm(true);\n        }\n      } catch (error) {\n        console.error(\"Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙØ§Ú©ØªÙˆØ±:\", error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchFactor();\n  }, [orderId]);\n  const handleCreateInvoice = async (e) => {\n    e.preventDefault();\n  \n    if (!price) {\n      alert(\"Ù„Ø·ÙØ§ Ù…Ø¨Ù„Øº Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯\");\n      return;\n    }\n  \n    setLoading(true);\n  \n    try {\n      const formData = new FormData();\n      formData.append(\"order\", orderDetails.id);\n      formData.append(\"price\", price);\n      if (invoiceFile) {\n        formData.append(\"invoice_file\", invoiceFile);\n      }\n  \n      const token = localStorage.getItem(\"token\"); // Ø§ÛŒÙ†Ø¬Ø§ ØªÙˆÚ©Ù† Ø±Ùˆ Ù…ÛŒÚ¯ÛŒØ±ÛŒÙ…\n  \n      const response = await fetch(\n        \"http://amin-beton-back.chbk.app/api/invoice-management/\",\n        {\n          method: \"POST\",\n          body: formData,\n          headers: {\n            Authorization: `Bearer ${token}`, // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‡Ø¯Ø± ØªÙˆÚ©Ù†\n          },\n        }\n      );\n  \n      if (response.ok) {\n        const data = await response.json();\n        alert(\"Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!\");\n  \n        setInvoices((prev) => [...prev, data]);\n  \n        setPrice(\"\");\n        setInvoiceFile(null);\n      } else {\n        alert(\"Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯!\");\n      }\n    } catch (error) {\n      console.error(\"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙØ§Ú©ØªÙˆØ±:\", error);\n      alert(\"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙØ§Ú©ØªÙˆØ±\");\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n\n  return (\n    <Wrapper>\n      <Title>ÙØ§Ú©ØªÙˆØ± Ù†Ù‡Ø§ÛŒÛŒ Ø³ÙØ§Ø±Ø´</Title>\n\n      {loading && <p>Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</p>}\n\n      {!loading && factor ? (\n        <InvoiceBox>\n          <p>ğŸ’° Ù‚ÛŒÙ…Øª: {factor.price} ØªÙˆÙ…Ø§Ù†</p>\n\n          <p>\n            ğŸ“ ÙØ§ÛŒÙ„ ÙØ§Ú©ØªÙˆØ±:{\" \"}\n            <a href={factor.factor} target=\"_blank\" rel=\"noopener noreferrer\">\n              Ø¯Ø§Ù†Ù„ÙˆØ¯\n            </a>\n          </p>\n        </InvoiceBox>\n      ) : (\n        !loading &&\n        showForm && (\n          <FormWrapper onSubmit={handleCreateFactor}>\n            <label>Ù‚ÛŒÙ…Øª ÙØ§Ú©ØªÙˆØ±:</label>\n            <InputField\n              type=\"number\"\n              value={price}\n              placeholder=\"Ù…Ø«Ù„Ø§Ù‹ 2000000\"\n              onChange={(e) => setPrice(e.target.value)}\n            />\n            <label>Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„ ÙØ§Ú©ØªÙˆØ±:</label>\n            <InputField\n              type=\"file\"\n              onChange={(e) => setFileLink(e.target.files[0])}\n            />\n\n            <SubmitButton type=\"submit\">Ø§ÛŒØ¬Ø§Ø¯ ÙØ§Ú©ØªÙˆØ±</SubmitButton>\n          </FormWrapper>\n        )\n      )}\n    </Wrapper>\n  );\n}\n\nFinalInvoiceSection.propTypes = {\n  orderDetails: PropTypes.shape({\n    id: PropTypes.number.isRequired, // id Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯\n    invoices: PropTypes.arrayOf(\n      PropTypes.shape({\n        id: PropTypes.number.isRequired, // id ÙØ§Ú©ØªÙˆØ± Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯\n        status: PropTypes.number.isRequired, // ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯\n        invoice_file: PropTypes.string, // ÙØ§ÛŒÙ„ ÙØ§Ú©ØªÙˆØ± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)\n        deny_reason: PropTypes.string, // Ø¯Ù„ÛŒÙ„ Ø±Ø¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)\n        created_at: PropTypes.string, // ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø±Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯\n        price: PropTypes.number.isRequired, // Ù‚ÛŒÙ…Øª Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯\n      })\n    ).isRequired, // Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯\n  }).isRequired, // `orderDetails` Ø¨Ø§ÛŒØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯\n};\n\nexport default FinalInvoiceSection;\n"
        }
    ]
}