{
    "sourceFile": "src/user-panel/OrdersPage.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1744179196201,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1744179330244,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -148,9 +148,8 @@\n           <div className=\"flex flex-col gap-4 sm:flex-row md:items-center\">\r\n             <h2 className=\"text-xs text-white md:text-2xl\">\r\n               لیست خریدهای پروژه\r\n             </h2>\r\n-\r\n             {projectInfo?.status === 1 && (\r\n               <ButtonProject\r\n                 onClick={() => navigate(`/SaleProject/${projectId}`)}\r\n                 className=\"text-sm w-36\"\r\n"
                },
                {
                    "date": 1744179342374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -148,16 +148,19 @@\n           <div className=\"flex flex-col gap-4 sm:flex-row md:items-center\">\r\n             <h2 className=\"text-xs text-white md:text-2xl\">\r\n               لیست خریدهای پروژه\r\n             </h2>\r\n+            <div>\r\n             {projectInfo?.status === 1 && (\r\n               <ButtonProject\r\n                 onClick={() => navigate(`/SaleProject/${projectId}`)}\r\n                 className=\"text-sm w-36\"\r\n               >\r\n                 <span className=\"text-xl\">+</span> خرید برای این پروژه\r\n               </ButtonProject>\r\n             )}\r\n+            </div>\r\n+        \r\n           </div>\r\n           <div className=\"flex flex-row gap-4\">\r\n             {projectInfo && (\r\n               <ButtonProject\r\n"
                },
                {
                    "date": 1744179436694,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,22 +144,24 @@\n           </p>\r\n         )}\r\n \r\n         <div className=\"container flex flex-row justify-between gap-4 px-4 my-10\">\r\n-          <div className=\"flex flex-col gap-4 sm:flex-row md:items-center\">\r\n-            <h2 className=\"text-xs text-white md:text-2xl\">\r\n-              لیست خریدهای پروژه\r\n-            </h2>\r\n-            <div>\r\n-              {projectInfo?.status === 1 && (\r\n-                <ButtonProject\r\n-                  onClick={() => navigate(`/SaleProject/${projectId}`)}\r\n-                  className=\"text-sm w-36\"\r\n-                >\r\n-                  <span className=\"text-xl\">+</span> خرید برای این پروژه\r\n-                </ButtonProject>\r\n-              )}\r\n-            </div>\r\n+        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\r\n+  <h2 className=\"text-base text-white sm:text-lg md:text-2xl\">\r\n+    لیست خریدهای پروژه\r\n+  </h2>\r\n+\r\n+  {projectInfo?.status === 1 && (\r\n+    <ButtonProject\r\n+      onClick={() => navigate(`/SaleProject/${projectId}`)}\r\n+      className=\"flex items-center justify-center w-full gap-2 text-sm sm:w-auto\"\r\n+    >\r\n+      <span className=\"text-xl\">+</span>\r\n+      خرید برای این پروژه\r\n+    </ButtonProject>\r\n+  )}\r\n+</div>\r\n+\r\n           </div>\r\n           <div className=\"flex flex-row gap-4\">\r\n             {projectInfo && (\r\n               <ButtonProject\r\n"
                },
                {
                    "date": 1744179449204,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,24 +144,22 @@\n           </p>\r\n         )}\r\n \r\n         <div className=\"container flex flex-row justify-between gap-4 px-4 my-10\">\r\n-        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\r\n-  <h2 className=\"text-base text-white sm:text-lg md:text-2xl\">\r\n-    لیست خریدهای پروژه\r\n-  </h2>\r\n-\r\n-  {projectInfo?.status === 1 && (\r\n-    <ButtonProject\r\n-      onClick={() => navigate(`/SaleProject/${projectId}`)}\r\n-      className=\"flex items-center justify-center w-full gap-2 text-sm sm:w-auto\"\r\n-    >\r\n-      <span className=\"text-xl\">+</span>\r\n-      خرید برای این پروژه\r\n-    </ButtonProject>\r\n-  )}\r\n-</div>\r\n-\r\n+          <div className=\"flex flex-col gap-4 sm:flex-row md:items-center\">\r\n+            <h2 className=\"text-xs text-white md:text-2xl\">\r\n+              لیست خریدهای پروژه\r\n+            </h2>\r\n+            <div>\r\n+              {projectInfo?.status === 1 && (\r\n+                <ButtonProject\r\n+                  onClick={() => navigate(`/SaleProject/${projectId}`)}\r\n+                  className=\"text-sm w-36\"\r\n+                >\r\n+                  <span className=\"text-xl\">+</span> خرید برای این پروژه\r\n+                </ButtonProject>\r\n+              )}\r\n+            </div>\r\n           </div>\r\n           <div className=\"flex flex-row gap-4\">\r\n             {projectInfo && (\r\n               <ButtonProject\r\n"
                }
            ],
            "date": 1744179196201,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport ButtonProject from \"../ui/ButtonProject\";\r\nimport HeaderNav from \"../ui/HeadingNav\";\r\nimport ProjectHeading from \"../ui/projectHeading\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport moment from \"moment-jalaali\";\r\nimport { toast } from \"react-toastify\";\r\nimport { ToastContainer } from \"react-toastify\";\r\n// 📌 تابع دریافت تاریخ شمسی\r\nconst getCurrentDate = () => {\r\n  moment.locale(\"fa\");\r\n  const date = moment();\r\n  return {\r\n    fullDate: date.format(\"jYYYY/jMM/jDD HH:mm:ss\"),\r\n    dayName: date.format(\"dddd\"),\r\n  };\r\n};\r\n\r\nexport default function OrdersPage() {\r\n  const navigate = useNavigate();\r\n  const { projectId } = useParams();\r\n  const [purchases, setPurchases] = useState([]);\r\n  const [projectInfo, setProjectInfo] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [currentDate, setCurrentDate] = useState(getCurrentDate());\r\n  const [modalOpen, setModalOpen] = useState(false);\r\n  const [modalAction, setModalAction] = useState(null);\r\n\r\n  // دریافت اطلاعات پروژه\r\n  const fetchProjectInfo = async () => {\r\n    try {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      const response = await axios.get(\r\n        `https://amin-beton-back.chbk.app/api/projects/${projectId}`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n      );\r\n      setProjectInfo(response.data);\r\n    } catch (error) {\r\n      console.error(\"خطا در دریافت اطلاعات پروژه:\", error);\r\n      setError(\"دریافت اطلاعات پروژه با مشکل مواجه شد.\");\r\n    }\r\n  };\r\n\r\n  // دریافت لیست خریدهای پروژه\r\n  const fetchPurchases = async () => {\r\n    try {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      const response = await axios.post(\r\n        \"https://amin-beton-back.chbk.app/api/orders/project-orders/\",\r\n        { project_id: projectId },\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n      );\r\n      setPurchases(response.data);\r\n    } catch (error) {\r\n      console.error(\"خطا در دریافت خریدها:\", error);\r\n      setError(\"دریافت اطلاعات خریدها با مشکل مواجه شد.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // 📌 تابع برای باز کردن مودال تأیید\r\n  const openModal = (action) => {\r\n    setModalAction(action);\r\n    setModalOpen(true);\r\n  };\r\n\r\n  // 📌 تابع تأیید و اجرای عملیات\r\n  const handleProjectAction = async () => {\r\n    if (!projectInfo || !modalAction) return;\r\n\r\n    const accessToken = localStorage.getItem(\"accessToken\");\r\n    let url = \"\";\r\n    let requestData = {};\r\n    let requestMethod = \"GET\"; // مقدار پیش‌فرض\r\n\r\n    if (modalAction === \"close\") {\r\n      url = `https://amin-beton-back.chbk.app/api/projects/${projectId}/`;\r\n      requestData = { status: 2 };\r\n      requestMethod = \"PATCH\";\r\n    } else {\r\n      url = `https://amin-beton-back.chbk.app/api/projects/${projectId}/open-project/`;\r\n    }\r\n\r\n    try {\r\n      const response = await axios({\r\n        method: requestMethod,\r\n        url,\r\n        headers: { Authorization: `Bearer ${accessToken}` },\r\n        ...(requestMethod === \"PATCH\" && { data: requestData }),\r\n      });\r\n\r\n      if (response.status === 200) {\r\n        toast.success(\r\n          modalAction === \"close\"\r\n            ? \"پروژه با موفقیت بسته شد\"\r\n            : \"پروژه با موفقیت باز شد\"\r\n        );\r\n        fetchProjectInfo(); // بروزرسانی اطلاعات پروژه\r\n      } else {\r\n        toast.error(\"خطا در انجام عملیات\");\r\n      }\r\n    } catch (error) {\r\n      toast.error(\"خطا در انجام عملیات\");\r\n    } finally {\r\n      setTimeout(() => setModalOpen(false), 500);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchProjectInfo();\r\n    fetchPurchases();\r\n  }, [projectId]);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setCurrentDate(getCurrentDate());\r\n    }, 60000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"min-h-screen overflow-x-hidden bg-Bokara-Grey\">\r\n      <ToastContainer position=\"top-center\" />\r\n      <div className=\"mx-auto\">\r\n        <HeaderNav className=\"bg-Armor-Wash\" />\r\n\r\n        {projectInfo ? (\r\n          <ProjectHeading\r\n            title={projectInfo.title}\r\n            subtitles={[\r\n              `آدرس پروژه: ${projectInfo.address}`,\r\n              // `تاریخ شروع: ${projectInfo.start_date}`,\r\n              // `تاریخ پایان: ${projectInfo.end_date}`,\r\n            ]}\r\n            date={currentDate.fullDate}\r\n            dayName={currentDate.dayName}\r\n          />\r\n        ) : (\r\n          <p className=\"text-center text-white\">\r\n            در حال دریافت اطلاعات پروژه...\r\n          </p>\r\n        )}\r\n\r\n        <div className=\"container flex flex-row justify-between gap-4 px-4 my-10\">\r\n          <div className=\"flex flex-col gap-4 sm:flex-row md:items-center\">\r\n            <h2 className=\"text-xs text-white md:text-2xl\">\r\n              لیست خریدهای پروژه\r\n            </h2>\r\n\r\n            {projectInfo?.status === 1 && (\r\n              <ButtonProject\r\n                onClick={() => navigate(`/SaleProject/${projectId}`)}\r\n                className=\"text-sm w-36\"\r\n              >\r\n                <span className=\"text-xl\">+</span> خرید برای این پروژه\r\n              </ButtonProject>\r\n            )}\r\n          </div>\r\n          <div className=\"flex flex-row gap-4\">\r\n            {projectInfo && (\r\n              <ButtonProject\r\n                className=\"self-center h-8 px-0 py-0 text-sm md:self-auto w-36\"\r\n                onClick={() =>\r\n                  openModal(projectInfo.status === 1 ? \"close\" : \"open\")\r\n                }\r\n              >\r\n                {projectInfo.status === 1 ? \"بستن پروژه\" : \"باز کردن پروژه\"}\r\n              </ButtonProject>\r\n            )}\r\n\r\n            <ButtonProject\r\n              className=\"self-center h-8 px-0 py-0 text-sm md:self-auto w-36\"\r\n              onClick={() => navigate(\"/ProjectPage\")}\r\n            >\r\n              بازگشت به صفحه پروژه‌ها\r\n            </ButtonProject>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {loading && (\r\n        <p className=\"text-center text-white\">در حال دریافت اطلاعات...</p>\r\n      )}\r\n      {error && <p className=\"text-center text-red-500\">{error}</p>}\r\n\r\n      {!loading && !error && (\r\n        <div className=\"flex flex-col items-center px-6 py-8\">\r\n          <div className=\"grid w-full max-w-5xl grid-cols-1 gap-6 md:grid-cols-2\">\r\n            {purchases.map((purchase) => (\r\n              <div\r\n                onClick={() => navigate(`/HistoryProject/${purchase.id}`)}\r\n                key={purchase.id}\r\n                className=\"flex flex-col w-full gap-4 px-5 py-8 text-white transition-all duration-200 bg-gray-800 border rounded-sm cursor-pointer md:flex-row md:gap-20 hover:bg-gray-700\"\r\n              >\r\n                <div className=\"flex flex-col flex-1 gap-2 pb-5 text-start md:text-right\">\r\n                  <h2 className=\"font-bold hover:text-yellow-500\">\r\n                    طبقه {purchase.name}\r\n                  </h2>\r\n                  <p className=\"text-sm\">دیوار و ستون {purchase.status}</p>\r\n                  <p className=\"text-sm\">تاریخ ارسال {purchase.order_id}</p>\r\n                  <p className=\"text-sm\">\r\n                    تاریخ ثبت سفارش {purchase.delivery_datetime}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {modalOpen && (\r\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60\">\r\n          <div className=\"p-10 text-center text-black rounded-lg bg-Bokara-Grey w-96\">\r\n            <h3 className=\"text-2xl font-bold text-red\">هشدار</h3>\r\n            <p className=\"mt-3 text-lg text-School-Bus\">\r\n              {modalAction === \"close\"\r\n                ? \"با بستن پروژه، ثبت سفارش جدید ممکن نیست. آیا مطمئن هستید؟\"\r\n                : \"آیا از باز کردن پروژه اطمینان دارید؟\"}\r\n            </p>\r\n            <div className=\"flex justify-between mt-5 bg-\">\r\n              <button\r\n                className=\"px-4 py-2 bg-black rounded-md text-School-Bus\"\r\n                onClick={() => setModalOpen(false)}\r\n              >\r\n                انصراف\r\n              </button>\r\n              <button\r\n                className=\"px-4 py-2 text-black bg-white rounded-md\"\r\n                onClick={handleProjectAction}\r\n              >\r\n                تأیید\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}