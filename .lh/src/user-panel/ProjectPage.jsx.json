{
    "sourceFile": "src/user-panel/ProjectPage.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1747686298900,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747686333039,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -166,28 +166,35 @@\n \r\n         <div className=\"grid items-center justify-center grid-cols-1 gap-4 px-8 py-10 cursor-pointer md:grid-cols-2 md:px-32\">\r\n           {/* نمایش پروژه‌ها */}\r\n           {projects.length === 0 ? (\r\n-            <p className=\"text-center text-white\">هیچ پروژه‌ای پیدا نشد.</p>\r\n-          ) : (\r\n-            projects.map((data) => (\r\n-              <div\r\n-                onClick={() => navigate(`/OrdersPage/${data.id}`)}\r\n-                key={data.id}\r\n-                className=\"relative flex flex-col items-center justify-center h-40 gap-10 text-white rounded-lg shadow-lg product-card md:h-60\"\r\n-              >\r\n-                <p>{data.title}</p>\r\n+  <p className=\"text-center text-white\">هیچ پروژه‌ای پیدا نشد.</p>\r\n+) : (\r\n+  projects.map((p) => (\r\n+    <div\r\n+      key={p.id}\r\n+      onClick={() => navigate(`/OrdersPage/${p.id}`)}\r\n+      className=\"relative flex flex-col items-center justify-center gap-2 text-white rounded-lg shadow-lg h-44 md:h-60 product-card\"\r\n+    >\r\n+      <p className=\"text-lg font-semibold\">{p.title}</p>\r\n \r\n-                {data.status === 1 ? (\r\n-                  <p className=\"text-School-Bus\">پروژه در حال انجام است</p>\r\n-                ) : data.status === 2 ? (\r\n-                  <p className=\"text-red\">پروژه به اتمام رسیده است</p>\r\n-                ) : (\r\n-                  <p className=\"text-yellow-400\">وضعیت نامشخص</p>\r\n-                )}\r\n-              </div>\r\n-            ))\r\n-          )}\r\n+      <p className=\"text-sm\">\r\n+        تاریخ شروع: {moment(p.start_date).format(\"jYYYY/jMM/jDD\")}\r\n+      </p>\r\n+      <p className=\"text-sm\">سفارش‌ها: {p.orders_count ?? 0}</p>\r\n+      <p className=\"text-sm\">مهندس ناظر: {p.supervising_engineer}</p>\r\n+\r\n+      {p.status === 1 ? (\r\n+        <p className=\"text-School-Bus\">در حال انجام</p>\r\n+      ) : p.status === 2 ? (\r\n+        <p className=\"text-red\">تمام شده</p>\r\n+      ) : (\r\n+        <p className=\"text-yellow-400\">نامشخص</p>\r\n+      )}\r\n+    </div>\r\n+  ))\r\n+)}\r\n+\r\n         </div>\r\n       </div>\r\n     </div>\r\n   );\r\n"
                },
                {
                    "date": 1747686440762,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -177,9 +177,9 @@\n               >\r\n                 <p className=\"text-lg font-semibold\">{p.title}</p>\r\n \r\n                 <p className=\"text-sm\">\r\n-                  تاریخ شروع: {moment(p.start_date).format(\"jYYYY/jMM/jDD\")}\r\n+                تاریخ پایان  : {moment(p.end_date*).format(\"jYYYY/jMM/jDD\")}\r\n                 </p>\r\n                 <p className=\"text-sm\">سفارش‌ها: {p.orders_count ?? 0}</p>\r\n                 <p className=\"text-sm\">مهندس ناظر: {p.supervising_engineer}</p>\r\n \r\n"
                },
                {
                    "date": 1747686639049,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -166,34 +166,41 @@\n \r\n         <div className=\"grid items-center justify-center grid-cols-1 gap-4 px-8 py-10 cursor-pointer md:grid-cols-2 md:px-32\">\r\n           {/* نمایش پروژه‌ها */}\r\n           {projects.length === 0 ? (\r\n-            <p className=\"text-center text-white\">هیچ پروژه‌ای پیدا نشد.</p>\r\n-          ) : (\r\n-            projects.map((p) => (\r\n-              <div\r\n-                key={p.id}\r\n-                onClick={() => navigate(`/OrdersPage/${p.id}`)}\r\n-                className=\"relative flex flex-col items-center justify-center gap-2 text-white rounded-lg shadow-lg h-44 md:h-60 product-card\"\r\n-              >\r\n-                <p className=\"text-lg font-semibold\">{p.title}</p>\r\n+  <p className=\"text-center text-white\">هیچ پروژه‌ای پیدا نشد.</p>\r\n+) : (\r\n+  projects.map((p) => (\r\n+    <div\r\n+      key={p.id}\r\n+      onClick={() => navigate(`/OrdersPage/${p.id}`)}\r\n+      className=\"relative flex flex-col items-center justify-center h-48 gap-2 text-white rounded-lg shadow-lg md:h-64 product-card\"\r\n+    >\r\n+      <p className=\"text-lg font-semibold\">عنوان: {p.title}</p>\r\n \r\n-                <p className=\"text-sm\">\r\n-                  تاریخ پایان : {moment(p.end_date).format(\"jYYYY/jMM/jDD\")}\r\n-                </p>\r\n-                <p className=\"text-sm\">سفارش‌ها: {p.orders_count ?? 0}</p>\r\n-                <p className=\"text-sm\">مهندس ناظر: {p.supervising_engineer}</p>\r\n+      <p className=\"text-sm\">\r\n+        تاریخ پایان: {moment(p.end_date).format(\"jYYYY/jMM/jDD\")}\r\n+      </p>\r\n+      <p className=\"text-sm\">سفارش‌ها: {p.orders_count ?? 0}</p>\r\n \r\n-                {p.status === 1 ? (\r\n-                  <p className=\"text-School-Bus\">در حال انجام</p>\r\n-                ) : p.status === 2 ? (\r\n-                  <p className=\"text-red\">تمام شده</p>\r\n-                ) : (\r\n-                  <p className=\"text-yellow-400\">نامشخص</p>\r\n-                )}\r\n-              </div>\r\n-            ))\r\n-          )}\r\n+      {/* فیلدهای درخواستی */}\r\n+      <p className=\"text-sm\">پلاک ثبتی: {p.registered_plate}</p>\r\n+      <p className=\"text-sm\">شماره پرونده: {p.case_number}</p>\r\n+      <p className=\"text-sm\">مهندس ناظر: {p.supervising_engineer}</p>\r\n+      <p className=\"text-sm\">سازنده: {p.builder}</p>\r\n+      <p className=\"text-sm\">کارفرما: {p.employer}</p>\r\n+\r\n+      {p.status === 1 ? (\r\n+        <p className=\"text-School-Bus\">در حال انجام</p>\r\n+      ) : p.status === 2 ? (\r\n+        <p className=\"text-red\">تمام شده</p>\r\n+      ) : (\r\n+        <p className=\"text-yellow-400\">نامشخص</p>\r\n+      )}\r\n+    </div>\r\n+  ))\r\n+)}\r\n+\r\n         </div>\r\n       </div>\r\n     </div>\r\n   );\r\n"
                }
            ],
            "date": 1747686298900,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport HeaderNav from \"../ui/HeadingNav\";\r\nimport ProjectHeading from \"../ui/projectHeading\";\r\nimport ButtonProject from \"../ui/ButtonProject\";\r\nimport moment from \"moment-jalaali\"; // import moment-jalaali\r\n\r\n// تابع برای بررسی اعتبار توکن و دریافت اطلاعات کاربر\r\nconst checkTokenValidity = async (navigate, setUserData) => {\r\n  const accessToken = localStorage.getItem(\"accessToken\");\r\n\r\n  if (!accessToken) {\r\n    navigate(\"/LoginForm\");\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(\r\n      \"https://amin-beton-back.chbk.app/api/users/me/\",\r\n      {\r\n        method: \"GET\",\r\n        headers: {\r\n          Authorization: `Bearer ${accessToken}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      }\r\n    );\r\n\r\n    if (response.ok) {\r\n      const userData = await response.json();\r\n      console.log(\"User Data:\", userData); // اضافه کردن این خط برای لاگ کردن داده‌ها\r\n      setUserData(userData);\r\n      return true;\r\n    }\r\n\r\n    if (response.status === 401 || response.status === 403) {\r\n      navigate(\"/loginForm\");\r\n      return false;\r\n    }\r\n\r\n    throw new Error(\"خطا در بررسی اعتبار توکن\");\r\n  } catch (error) {\r\n    console.error(error);\r\n    navigate(\"/LoginForm\");\r\n    return false;\r\n  }\r\n};\r\nconst fetchProjects = async () => {\r\n  const tokenIsValid = await checkTokenValidity(navigate, setUserData);\r\n  if (!tokenIsValid) return;\r\n\r\n  try {\r\n    const accessToken = localStorage.getItem(\"accessToken\");\r\n    const response = await axios.get(\r\n      \"https://amin-beton-back.chbk.app/api/projects/\",\r\n      {\r\n        headers: {\r\n          Authorization: `Bearer ${accessToken}`, // ← back-tick و ${}\r\n        },\r\n      }\r\n    );\r\n\r\n    const sorted = response.data.sort((a, b) =>\r\n      moment(b.start_date).diff(moment(a.start_date))\r\n    );\r\n    setProjects(sorted);\r\n  } catch (err) {\r\n    console.error(\"خطا در دریافت لیست پروژه‌ها:\", err);\r\n  }\r\n};\r\n\r\n// تابع برای دریافت تاریخ شمسی و نام روز هفته\r\nconst getCurrentDate = () => {\r\n  moment.locale(\"fa\");\r\n  const date = moment();\r\n  return {\r\n    fullDate: date.format(\"jYYYY/jMM/jDD HH:mm:ss\"),\r\n    dayName: date.format(\"dddd\"),\r\n  };\r\n};\r\n\r\nexport default function Dashboard() {\r\n  const navigate = useNavigate();\r\n\r\n  const [projects, setProjects] = useState([]);\r\n  const [currentDate, setCurrentDate] = useState(getCurrentDate());\r\n  const [userData, setUserData] = useState({\r\n    first_name: \"\",\r\n    national_code: \"\",\r\n    last_order: \"\",\r\n    projects: 0,\r\n  });\r\n\r\n  // واکشی داده‌ها از API برای پروژه‌ها\r\n  const fetchProjects = async () => {\r\n    const tokenIsValid = await checkTokenValidity(navigate, setUserData);\r\n    if (!tokenIsValid) return;\r\n\r\n    try {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      const response = await axios.get(\r\n        \"https://amin-beton-back.chbk.app/api/projects/\",\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${accessToken}`,\r\n          },\r\n        }\r\n      );\r\n\r\n      const sortedProjects = response.data.sort((a, b) => {\r\n        return moment(b.start_date).diff(moment(a.start_date)); // تغییر به start_date\r\n      });\r\n\r\n      setProjects(sortedProjects);\r\n    } catch (err) {\r\n      console.error(\"خطا در دریافت لیست پروژه‌ها:\", err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchProjects();\r\n  }, []);\r\n\r\n  // تابع بررسی اتمام پروژه\r\n  const isProjectCompleted = (endDate) => {\r\n    if (!endDate) return false;\r\n    return moment().isAfter(moment(endDate, \"YYYY-MM-DD\"));\r\n  };\r\n\r\n  // استفاده از useEffect برای بروزرسانی تاریخ جاری هر ثانیه\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setCurrentDate(getCurrentDate());\r\n      console.log(\"تاریخ جاری:\", currentDate.fullDate);\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"w-full min-h-screen bg-Bokara-Grey\">\r\n      <div className=\"pb-28\">\r\n        <HeaderNav className=\"bg-Armor-Wash\" />\r\n        <ProjectHeading\r\n          title=\"پنل کاربری\"\r\n          subtitles={[\r\n            \"نام کاربری: \" + userData.first_name,\r\n            \"کد ملی: \" + userData.national_code,\r\n            \"تعداد پروژه‌های فعال: \" + userData.projects,\r\n            // \"تاریخ آخرین خرید: \" + userData.last_order,\r\n          ]}\r\n          date={currentDate.fullDate}\r\n        />\r\n\r\n        <div className=\"container flex flex-col w-full py-6 mt-4 border-b border-white md:flex-row\">\r\n          <div className=\"flex flex-col items-center justify-center w-full py-6 mt-4\">\r\n            <ButtonProject\r\n              className=\"w-56 py-1 text-center\"\r\n              onClick={() => navigate(\"/Addproject\")}\r\n            >\r\n              افزودن پروژه\r\n            </ButtonProject>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid items-center justify-center grid-cols-1 gap-4 px-8 py-10 cursor-pointer md:grid-cols-2 md:px-32\">\r\n          {/* نمایش پروژه‌ها */}\r\n          {projects.length === 0 ? (\r\n            <p className=\"text-center text-white\">هیچ پروژه‌ای پیدا نشد.</p>\r\n          ) : (\r\n            projects.map((data) => (\r\n              <div\r\n                onClick={() => navigate(`/OrdersPage/${data.id}`)}\r\n                key={data.id}\r\n                className=\"relative flex flex-col items-center justify-center h-40 gap-10 text-white rounded-lg shadow-lg product-card md:h-60\"\r\n              >\r\n                <p>{data.title}</p>\r\n\r\n                {data.status === 1 ? (\r\n                  <p className=\"text-School-Bus\">پروژه در حال انجام است</p>\r\n                ) : data.status === 2 ? (\r\n                  <p className=\"text-red\">پروژه به اتمام رسیده است</p>\r\n                ) : (\r\n                  <p className=\"text-yellow-400\">وضعیت نامشخص</p>\r\n                )}\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}