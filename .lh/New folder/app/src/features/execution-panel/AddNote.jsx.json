{
    "sourceFile": "New folder/app/src/features/execution-panel/AddNote.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1747688219702,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747688357160,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,20 +66,24 @@\n       const tokenData = JSON.parse(localStorage.getItem(\"token\"));\r\n       const token = tokenData?.access;\r\n \r\n       if (!token) throw new Error(\"توکن یافت نشد\");\r\n-\r\n-      const response = await fetch(\r\n-        \"https://amin-beton-back.chbk.app/api/order-management/get-order-notes/\",\r\n+      const res = await fetch(\r\n+        \"https://amin-beton-back.chbk.app/api/order-management/add-order-note/\",\r\n         {\r\n           method: \"POST\",\r\n           headers: {\r\n             \"Content-Type\": \"application/json\",\r\n             Authorization: `Bearer ${token}`,\r\n           },\r\n-          body: JSON.stringify({ order_id: orderId, panel }),\r\n+          body: JSON.stringify({\r\n+            order: orderId,   // اسم فیلد طبق داکیومنت «order» است\r\n+            panel,            // execution | sales | financial\r\n+            text: noteText,   // متن یادداشت\r\n+          }),\r\n         }\r\n       );\r\n+      \r\n \r\n       if (!response.ok) throw new Error(\"خطا در دریافت یادداشت‌ها\");\r\n \r\n       const data = await response.json();\r\n"
                },
                {
                    "date": 1747688377850,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,9 +77,9 @@\n           },\r\n           body: JSON.stringify({\r\n             order: orderId, // اسم فیلد طبق داکیومنت «order» است\r\n             panel, // execution | sales | financial\r\n-            text: noteText, // متن یادداشت\r\n+            text // متن یادداشت\r\n           }),\r\n         }\r\n       );\r\n \r\n"
                }
            ],
            "date": 1747688219702,
            "name": "Commit-0",
            "content": "import styled from \"styled-components\";\r\nimport { useEffect, useState } from \"react\";\r\nimport AddNote from \"../sale-panel/AddNote\";\r\n\r\nconst StyledOrderNotes = styled.div`\r\n  h3 {\r\n    margin-bottom: 3rem;\r\n  }\r\n\r\n  ul {\r\n    max-height: 300px;\r\n    overflow-y: auto;\r\n    margin-bottom: 2rem;\r\n    padding-right: 1rem;\r\n  }\r\n\r\n  li {\r\n    margin-bottom: 2rem;\r\n    padding-bottom: 1rem;\r\n    border-bottom: 1px solid #ccc;\r\n  }\r\n\r\n  .note-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    margin-bottom: 0.5rem;\r\n  }\r\n\r\n  .panel-label {\r\n    font-weight: bold;\r\n    color: #555;\r\n  }\r\n\r\n  .note-date {\r\n    font-size: 0.85rem;\r\n    color: #888;\r\n  }\r\n\r\n  .add-button {\r\n    margin-top: 1rem;\r\n    padding: 0.5rem 1rem;\r\n    background-color: #28a745;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n  }\r\n`;\r\n\r\nconst panelLabels = {\r\n  sales: \"فروش\",\r\n  financial: \"مالی\",\r\n  execution: \"اجرا\",\r\n};\r\n\r\nfunction OrderNotesWrapper({ orderId, panel }) {\r\n  const [notes, setNotes] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [showAddNote, setShowAddNote] = useState(false);\r\n\r\n  const fetchNotes = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const tokenData = JSON.parse(localStorage.getItem(\"token\"));\r\n      const token = tokenData?.access;\r\n\r\n      if (!token) throw new Error(\"توکن یافت نشد\");\r\n\r\n      const response = await fetch(\r\n        \"https://amin-beton-back.chbk.app/api/order-management/get-order-notes/\",\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n          body: JSON.stringify({ order_id: orderId , panel  }),\r\n        }\r\n      );\r\n\r\n      if (!response.ok) throw new Error(\"خطا در دریافت یادداشت‌ها\");\r\n\r\n      const data = await response.json();\r\n      setNotes(data);\r\n    } catch (err) {\r\n      setError(err.message || \"خطای ناشناخته\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (orderId) fetchNotes();\r\n  }, [orderId]);\r\n\r\n  const handleNoteAdded = () => {\r\n    setShowAddNote(false);\r\n    fetchNotes();\r\n  };\r\n\r\n  if (loading) return <p>در حال بارگذاری...</p>;\r\n  if (error) return <p>خطا: {error}</p>;\r\n\r\n  return (\r\n    <StyledOrderNotes>\r\n      {!showAddNote && (\r\n        <>\r\n          <ul>\r\n            {notes.length === 0 ? (\r\n              <p>یادداشتی ثبت نشده است.</p>\r\n            ) : (\r\n              notes.map((note) => (\r\n                <li key={note.id}>\r\n                  <div className=\"note-header\">\r\n                    <span className=\"panel-label\">\r\n                      {panelLabels[note.panel] || note.panel}\r\n                    </span>\r\n                    <span className=\"note-date\">\r\n                      {new Date(note.created_at).toLocaleString(\"fa-IR\")}\r\n                    </span>\r\n                  </div>\r\n                  <p>{note.text}</p>\r\n                </li>\r\n              ))\r\n            )}\r\n          </ul>\r\n\r\n          <button className=\"add-button\" onClick={() => setShowAddNote(true)}>\r\n            افزودن یادداشت\r\n          </button>\r\n        </>\r\n      )}\r\n\r\n      {showAddNote && (\r\n        <AddNote\r\n          orderId={orderId}\r\n          panel={panel}\r\n          onCloseModal={() => setShowAddNote(false)}\r\n          onConfirm={handleNoteAdded}\r\n        />\r\n      )}\r\n    </StyledOrderNotes>\r\n  );\r\n}\r\n\r\nexport default OrderNotesWrapper;\r\n"
        }
    ]
}